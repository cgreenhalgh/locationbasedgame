<html>
 <head>
  <title>Locationbasedgame overview</title>
 </head>
 <body>
  <h1>locationbasedgame Overview</h1>
  <p>Chris Greenhalgh, 2010-11-22</p>
  <p>This is intended to be a simple location-based game engine, hosted on Google App Engine, with a HTML/JS client, managed by the lobbyservice.</p>
  <h2>Lobby Service Interaction</h2>
  <p>The lobby service is responsible for:</p>
  <ul>
  	<li>Client authentication</li>
  	<li>Registering client(s) with the game server for a specific game</li>
  	<li>Client (application) checking and start-up</li>
  	<li>Starting and stopping games (optional, as configured in the lobby service game instance factory)</li>
  </ul>
  <p>The lobby's support for a "Game Server" is pluggable, but currently on one implementation exists: "EXPLODING_PLACES". </p>
  <h3>EXPLODING_PLACES server protocol</h3>
  <p>The EXPLODING_PLACES server protocol requires the following entry points on the managed server:</p>
  <h4>/orchestration/content_group_list (GET)</h4>
  <p>returning</p>
  <pre>&lt;array size="2" elementjavatype="java.lang.Object">
	&lt;item>
		&lt;ContentGroup package="uk.ac.horizon.ug.exploding.db">
			&lt;ID>CG500&lt;/ID> 
			&lt;name>gameState.xml&lt;/name> 
			&lt;version>1.0&lt;/version> 
			&lt;location>Woolwich&lt;/location> 
			&lt;startYear>1900&lt;/startYear> 
			&lt;endYear>2020&lt;/endYear> 
		&lt;/ContentGroup>
	&lt;/item>
&lt;array>
  </pre>
  <p>Of these, the structure is important, as are the "item", "ContentGroup" and "ID" element names.
  The other inner element names are just string matched against any properties within the "contentGroup" 
  element of GameInstanceFactory's "serverConfigJson".</p>
  <h4>/orchestration/lobby_create (POST)</h4>
  <p>with URL-encoded parameters:</p>
  <ul>
   	<li>contentGroupID = UTF-8-encoded ID from content_group_list</li>
   	<li>name = lobby-provided game name string</li>
   	<li>tag = lobby-generated (unique) game tag string</li>
  </ul>
  <p>on success returns</p>
  <pre>&lt;?xml version="1.0"?>
&lt;Game package="uk.ac.horizon.ug.exploding.db">
   &lt;ID>GA514&lt;/ID>
   &lt;contentGroupID>CG500&lt;/contentGroupID>
   &lt;name>name&lt;/name>
   &lt;tag>tag&lt;/tag>
   &lt;timeCreated>1283957181008&lt;/timeCreated>
   &lt;gameTimeID>GT514&lt;/gameTimeID>
   &lt;state>NOT_STARTED&lt;/state>
&lt;/Game>
  </pre>
  <p>Where only the "ID" element name is significant.</p>
  <p>The server-generated game ID ("gameId") and lobby-generated tag ("gameTag") are persisted in the lobby GameInstance "serverConfigJson".</p>
  <h4>/orchestration/play.html?gameID=[gameId] (POST)</h4>
  <p>Mark game state as active, i.e. live and current.</p>
  <h4>/orchestration/stop.html?gameID=[gameId] (POST)</h4>
  <p>Mark game state as stopping, i.e. no longer live, but not yet deleted.</p>
  <h4>/orchestration/finish.html?gameID=[gameId] (POST)</h4>
  <p>Mark game state as ended, i.e. could be deleted.</p>
  <h4>/rpc/login (POST)</h4>
  <p>With post body request like:</p>
  <pre>&lt;login>
	&lt;clientId>...&lt;/clientId>
	&lt;conversationId>...&lt;/conversationId>
	&lt;playerName>...&lt;/playerName>
	&lt;clientVersion>1&lt;/clientVersion>
	&lt;clientType>AndroidDevclient&lt;/clientType>
&lt;/login>
  </pre>
  <p>Where:</p>
  <ul>
   	<li>clientId is the GameClient's clientId (i.e. persistent client identifier)</li>
   	<li>conversationId is a newly-generated unique session ID (string)</li>
   	<li>playerName is the GameSlot nickname or default player name or "Anonymous"</li>
  </ul>
  <p>The response must be an XML document of the form</p>
  <pre>&lt;response>
	&lt;status>OK&lt;/status> [or FAILED or GAME_NOT_FOUND => try later]
    &lt;message>...&lt;/message>         
    &lt;gameId>...&lt;/gameId>
    &lt;gameStatus>...&lt;/gameStatus>
&lt;/response>
  </pre>
  <p>The clientVersion and clientType are currently hard-coded in the ExplodingPlacesServerProtocol class (not obtained from the client or configuration).</p>
  <h4>Handover to the client</h4> 
  <p>The GameJoinResponse playUrl is set to [server.baseUrl]/rpc/</p>
  <p>The GameJoinResponse playData is (if successful) JSON encoded with properties:</p>
  <ul>
  	<li>conversationId - as generated by lobby service and used in game server login</li>
  	<li>gameId - as returned by game server to lobby login</li>
  	<li>gameStatus - as return by game server to lobby login</li>
  </ul>
 </body>
</html>